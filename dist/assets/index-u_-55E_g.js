(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const o of t.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function i(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function s(e){if(e.ep)return;e.ep=!0;const t=i(e);fetch(e.href,t)}})();const c=document.getElementById("map"),u=document.getElementById("table");c.innerHTML='<div class="flex justify-center items-center h-full"><div class="animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600"></div><p class="mt-2 text-gray-600">Loading map...</p></div>';u.innerHTML='<div class="flex justify-center items-center h-full"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div><p class="mt-2 text-gray-600">Loading data...</p></div>';const d=L.map("map",{center:[0,0],zoom:2,maxBounds:[[-90,-180],[90,180]],maxBoundsViscosity:1,worldCopyJump:!1});L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Â© OpenStreetMap contributors"}).addTo(d).on("load",()=>{const r=c.querySelector(".flex");r&&(r.style.display="none")});let l={};fetch("http://localhost:3000/aggregate-data",{headers:{Authorization:"Bearer _W3xxeyUYnTnzftCsRtULRT2UGG5Dja5eOhsKZ_L"}}).then(r=>r.json()).then(r=>(l=r.countries,fetch("/countries.geojson"))).then(r=>r.json()).then(r=>{L.geoJSON(r,{style:function(s){const e=s.properties["ISO3166-1-Alpha-2"],t=l[e]?.status||"UNKNOWN";let o="gray",n=.5;return t==="OUTAGE"?o="red":t==="NORMAL"&&(n=0),{color:o,fillColor:o,weight:1,fillOpacity:n}},onEachFeature:function(s,e){const t=s.properties["ISO3166-1-Alpha-2"],o=l[t];let n=`${s.properties.name}<br>Status: ${o?.status||"UNKNOWN"}`;o?.status==="OUTAGE"&&(n+=`<br>Cause: ${o.cause}<br>Since: ${new Date(o.since).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}`),e.bindTooltip(n),e.unbindPopup()}}).addTo(d);const a=document.getElementById("table"),i=Object.entries(l).filter(([s,e])=>e.status==="OUTAGE");if(i.length>0){let s='<h2 class="text-xl font-bold mb-2">Outage Countries</h2><table class="table-auto w-full border-collapse border border-gray-300"><thead><tr class="bg-gray-200"><th class="border border-gray-300 px-4 py-2">Country</th><th class="border border-gray-300 px-4 py-2">Status</th><th class="border border-gray-300 px-4 py-2">Cause</th><th class="border border-gray-300 px-4 py-2">Since</th></tr></thead><tbody>';i.forEach(([e,t])=>{const o=r.features.find(n=>n.properties["ISO3166-1-Alpha-2"]===e)?.properties.name||e;s+=`<tr><td class="border border-gray-300 px-4 py-2">${o}</td><td class="border border-gray-300 px-4 py-2">${t.status}</td><td class="border border-gray-300 px-4 py-2">${t.cause}</td><td class="border border-gray-300 px-4 py-2">${new Date(t.since).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}</td></tr>`}),s+="</tbody></table>",a.innerHTML=s}}).catch(r=>{console.error("Error:",r),c.innerHTML='<div class="flex justify-center items-center h-full"><p class="text-red-600 text-center">Failed to load map. Please check your connection and try again.</p></div>',u.innerHTML='<div class="flex justify-center items-center h-full"><p class="text-red-600 text-center">Failed to load data. Please check your connection and try again.</p></div>'});d.invalidateSize();
